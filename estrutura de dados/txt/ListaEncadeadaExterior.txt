// ðŸ§© Classe No: representa um nÃ³ da lista encadeada
// Cada nÃ³ guarda um valor e uma referÃªncia para o prÃ³ximo nÃ³
class No {
    constructor(valor) {
        this.valor = valor; // ðŸ—ƒï¸ Valor armazenado no nÃ³
        this.proximo = null; // ðŸ”— ReferÃªncia para o prÃ³ximo nÃ³
    }
     constructor(valor, proximo = null) {
        this.valor = valor; // ðŸ—ƒï¸ Valor armazenado no nÃ³
        this.proximo = proximo; // ðŸ”— ReferÃªncia para o prÃ³ximo nÃ³ (padrÃ£o Ã© null
     }
}

// ðŸ“š Classe ListaEncadeada: controla a corrente de colisÃµes
// Permite adicionar valores e imprimir a lista encadeada
class ListaEncadeada {
    constructor() {
        this.inicio = null; // ðŸš© ReferÃªncia para o primeiro nÃ³ da lista
    }

    // âž• Adiciona um novo valor ao final da lista
    // Se a lista estiver vazia, o novo nÃ³ vira o inÃ­cio
    // Caso contrÃ¡rio, percorre atÃ© o Ãºltimo nÃ³ e adiciona lÃ¡
    adicionar_no_NO(valor) {
        console.log(`âž• [ListaEncadeada] Adicionando valor: ${valor}`);

        // Verifica se a lista estÃ¡ vazia
        if (this.inicio) {
            
            console.log("ðŸ’¥ [COLISAO]");
            console.log("ðŸ”— [ListaEncadeada] Lista NÃƒO estÃ¡ vazia, procurando o final...");
            let atual = this.inicio;
            let passos = 0;
            while (atual.proximo) {
                console.log(`ðŸ”Ž [ListaEncadeada] Passo ${passos}: nÃ³ atual = ${atual.valor}`);
                atual = atual.proximo;
                passos++;
            }
            console.log(`ðŸ [ListaEncadeada] Ãšltimo nÃ³ encontrado: ${atual.valor}`);
            atual.proximo = new No(valor); // ðŸ”— Adiciona ao final
            console.log(`âœ… [ListaEncadeada] NÃ³ com valor ${valor} adicionado ao final!`);
        } else {
            console.log("ðŸš© [ListaEncadeada] Lista estÃ¡ vazia, criando o primeiro nÃ³...");
            this.inicio = new No(valor); // ðŸ Lista estava vazia, novo nÃ³ Ã© o inÃ­cio
            console.log(`âœ… [ListaEncadeada] Novo nÃ³ (${valor}) Ã© o inÃ­cio da lista!`);
        }
    }

    // ðŸ” Busca um valor na lista encadeada
    buscar_na_lista(valor) {
        console.log(`ðŸ”Ž [Busca] Procurando valor ${valor} na lista...`);
        let atual = this.inicio;
        let posicao = 0;

        while (atual) {
            console.log(`ðŸ” Verificando nÃ³ na posiÃ§Ã£o ${posicao} com valor: ${atual.valor}`);
            if (atual.valor === valor) {
                console.log(`âœ… [Busca] Valor ${valor} encontrado na posiÃ§Ã£o ${posicao}!`);
                return true;
            }
            atual = atual.proximo;
            posicao++;
        }

        console.log(`âŒ [Busca] Valor ${valor} nÃ£o encontrado na lista.`);
        return false;
    }

    // âŒ Remove um valor da lista encadeada (se existir)
    remover_da_lista(valor) {
        console.log(`ðŸ—‘ï¸ [RemoÃ§Ã£o] Tentando remover valor ${valor} da lista...`);

        if (!this.inicio) {
            console.log("âš ï¸ [RemoÃ§Ã£o] Lista estÃ¡ vazia, nada a remover.");
            return;
        }

        // Caso especial: valor estÃ¡ logo no inÃ­cio
        if (this.inicio.valor === valor) {
            console.log(`ðŸš¨ [RemoÃ§Ã£o] Valor ${valor} era o primeiro nÃ³. Removido!`);
            this.inicio = this.inicio.proximo;
            return;
        }

        let posicao_atual = this.inicio;
        let anterior = null;

        while (posicao_atual && posicao_atual.valor !== valor) {
            anterior = posicao_atual;
            posicao_atual = posicao_atual.proximo;
        }

        if (posicao_atual) {
            console.log(`âœ… [RemoÃ§Ã£o] Valor ${valor} encontrado e removido.`);
            anterior.proximo = atual.proximo;
        } else {
            console.log(`âŒ [RemoÃ§Ã£o] Valor ${valor} nÃ£o encontrado. Nada foi removido.`);
        }
    }


    // ðŸ–¨ï¸ Imprime todos os valores da lista encadeada
    // Percorre do inÃ­cio atÃ© o fim, mostrando cada valor
    imprimir() {
        let atual = this.inicio;
        let resultado = "";
        let pos = 0;

        if (!atual) {
            // console.log("âš ï¸ [ListaEncadeada] Lista estÃ¡ vazia!");
            return "null";
        }

        while (atual) {
            // console.log(`ðŸ“ [ListaEncadeada] NÃ³ ${pos}: ${atual.valor}`);
            resultado += `[${atual.valor}] â†’ `; // ðŸ“ Mostra valor do nÃ³
            atual = atual.proximo;
            pos++;
        }

        // console.log("âœ… [ListaEncadeada] Fim da lista!");
        return resultado + "null"; // âœ… Fim da lista
    }
}

// ðŸ—ƒï¸ Classe TabelaHash: estrutura principal da tabela hash
// Usa encadeamento exterior para tratar colisÃµes
class TabelaHash {
    constructor() {
        this.tamanho = 6; // ðŸ”¢ Tamanho fixo da tabela
        this.tabela = Array.from({ length: this.tamanho },() => new ListaEncadeada());        // ðŸª£ Cada posiÃ§Ã£o Ã© uma ListaEncadeada (bucket)
    }

    // ðŸ”‘ FunÃ§Ã£o de hash: calcula o Ã­ndice para o valor
    gera_indice_hash_DJB2(valor) {
        let str = valor.toString();
        let hash = 5381;
        for (let i = 0; i < str.length; i++) {
            hash = 33 + hash + str.charCodeAt(i);
        }
        return Math.abs(hash) % this.tamanho;
    }

    // âž• Insere valor na tabela, tratando colisÃ£o por encadeamento
    inserir_item_tabela_hash(valor) {
        const indice = this.gera_indice_hash_DJB2(valor);
        console.log(`ðŸ” Inserindo ${valor} no Ã­ndice ${indice}`);
        this.tabela[indice].adicionar_no_NO(valor); // Adiciona no bucket correto
    }

    // ðŸ–¨ï¸ Imprime toda a tabela hash
    imprimirTabela() {
        console.log("\nðŸ“‹ Tabela Hash com Encadeamento Exterior:");
        for (let i = 0; i < this.tabela.length; i++) {
            // Mostra cada Ã­ndice e sua corrente de colisÃµes
            console.log(`********************************* Ãndice ${i}: ${this.tabela[i].imprimir()}`);
        }
    }
}

// ðŸš€ Exemplo de uso da Tabela Hash
const tabela = new TabelaHash();

tabela.inserir_item_tabela_hash(12); 
tabela.inserir_item_tabela_hash(21); 
tabela.inserir_item_tabela_hash(9);  
tabela.inserir_item_tabela_hash(33); 
tabela.inserir_item_tabela_hash(10); 

tabela.imprimirTabela(); // Mostra toda a tabela e as colisÃµes
